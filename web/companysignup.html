<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>注册 - 启迪之星</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />


    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/axios.min.js"></script>
    <!-- selectize js -->
    <script src="js/selectize.min.js"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>

    <script src="js/app.js"></script>
    <script src="js/Captcha.js"></script>

    <!--表单验证 js-->
    <script src="js/form-validator.js"></script>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">

    <!--Material Icon -->
    <link rel="stylesheet" type="text/css" href="css/materialdesignicons.min.css" />

    <link rel="stylesheet" type="text/css" href="css/selectize.css" />

    <link rel="stylesheet" type="text/css" href="css/nice-select.css" />

    <!-- Custom  Css -->
    <link rel="stylesheet" type="text/css" href="css/style.css" />

</head>

<body>
    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner">
                <div class="double-bounce1"></div>
                <div class="double-bounce2"></div>
            </div>
        </div>
    </div>
    <!-- Loader -->

    <div class="back-to-home rounded d-none d-sm-block">
        <a href="index.html" class="text-white rounded d-inline-block text-center"><i class="mdi mdi-home"></i></a>
    </div>

    <!-- Hero Start -->
    <section class="vh-100" style="background: url('') center center;">
        <div class="home-center">
            <div class="home-desc-center">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <div class="login_page bg-white shadow rounded p-4" id='app'>
                                <div class="text-center">
                                    <h4 class="mb-4">企业注册</h4>
                                </div>
                                <div class="login-form">
                                    <form action="javascript:toSubmit()" method="post">
                                        <div class="row">
                                          <div class="col-md-12">
                                            <div class="form-group position-relative">
                                              <label>企业名称(企业用户名)<span class="text-danger"> *</span></label>
                                              <input type="text" class="form-control" placeholder="用于登录的企业用户名" name="phone" required v-model='phone' minlength="1" maxlength="100">
                                            </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="form-group position-relative">
                                              <label>企业简称</label>
                                              <input required type="text" class="form-control" placeholder="大家熟知的名字" name="username" v-model='username' minlength="1" maxlength="20">
                                            </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="form-group app-label mt-2">
                                              <label>企业类型<span class="text-danger"> *</span></label>
                                              <div class="form-button">
                                                <select required class="nice-select rounded" v-model="companytype">
                                                  <option value="有限责任公司">有限责任公司</option>
                                                  <option value="股份有限公司">股份有限公司</option>
                                                </select>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="form-group app-label mt-2">
                                              <label>企业规模(人)<span class="text-danger"> *</span></label>
                                              <div class="form-button">
                                                <select required class="nice-select rounded" v-model="companysize">
                                                  <option value="2000以上">2000以上</option>
                                                  <option value="500-2000">500-2000</option>
                                                  <option value="200-500">200-500</option>
                                                  <option value="50-200">50-200</option>
                                                  <option value="15-50">15-50</option>
                                                  <option value="1-15">1-15</option>
                                                </select>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="form-group position-relative">
                                              <label>所在地区<span class="text-danger"> *</span></label>
                                              <input type="text" class="form-control" placeholder="企业所在地区" name="place" required v-model='place' minlength="1" maxlength="50">
                                            </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="form-group position-relative">
                                              <label>注册资金(万元) <span class="text-danger"> *</span></label>
                                              <b><span style="color:red;font-size: 13px">{{tip.fund}}</span></b>
                                              <input type="text" class="form-control" placeholder="注册资金" required name="password" v-model.lazy='fund' @blur="check(fund,1,{minlength: 1, maxlength: 10})" minlength="1" maxlength="10">
                                            </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="form-group position-relative">
                                              <label>所属行业<span class="text-danger"> *</span></label>
                                              <div class="form-button">
                                                <select required class="nice-select rounded" v-model="companynature">
                                                  <option value="互联网/游戏/软件">互联网/游戏/软件</option>
                                                  <option value="农林牧渔">农林牧渔</option>
                                                  <option value="教育/培训">教育/培训</option>
                                                  <option value="房产/家居/物业/建筑">房产/家居/物业/建筑</option>
                                                  <option value="广告/传媒/公关/展览">广告/传媒/公关/展览</option>
                                                  <option value="其他">其他</option>
                                                </select>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="col-md-12">
                                            <div class="form-group position-relative">
                                              <label>负责人手机号<span class="text-danger"> *</span> </label>
                                              <b><span style="color:red;font-size: 13px">{{tip.personphone}}</span></b>
                                              <input type="text" class="form-control" placeholder="负责人手机号" name="password" v-model.lazy='personphone' @blur="check(personphone,2,{minlength: 11, maxlength: 11})" minlength="11" maxlength="11">
                                            </div>
                                          </div>
                                          <div class="col-md-12">
                                            <div class="form-group position-relative">
                                              <label>企业邮箱 <span class="text-danger"> *</span></label>
                                              <b><span style="color:red;font-size: 13px">{{tip.email}}</span></b>
                                              <input type="email" class="form-control" placeholder="企业邮箱" required name="email" v-model.lazy='email' @blur="check(email,3,{minlength: 1, maxlength: 50})" minlength="1" maxlength="50">
                                              <input type="text" class="form-control phone-Captcha" placeholder="输入验证码" name="Captcha" required v-model.lazy="emailValidateCode">
                                              <div class="but_w_h">
                                                <input type="button" class="btn btn-primary btn-sm" id="verCodeBtn" onclick="sendValidateCode()" value="获取验证码">
                                              </div>
                                            </div>
                                          </div>
                                          <div class="col-md-12">
                                            <div class="form-group position-relative">
                                              <label>企业简介<span class="text-danger"> *</span></label>
                                              <input required class="form-control" placeholder="企业简介" name="password" v-model='simpletro' minlength="5" maxlength="800">
                                            </div>
                                          </div>
                                          <div class="col-lg-12">
                                            <div class="form-group app-label">
                                              <label>企业介绍<span class="text-danger"> *</span></label>
                                              <textarea required id="addition-information-1" rows="4" class="form-control resume" placeholder="" v-model="introduce" minlength="10" maxlength="2000"></textarea>
                                            </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="form-group app-label">
                                              <label>是否上市<span class="text-danger"> *</span></label>
                                              <div class="form-button">
                                                <select required class="nice-select rounded" v-model="listed">
                                                  <option value="1">是</option>
                                                  <option value="2">否</option>
                                                </select>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="col-lg-6">
                                            <div class="form-group app-label">
                                              <label>总部位置<span class="text-danger"> *</span></label>
                                              <input required class="form-control" placeholder="总部位置" v-model="headquarters" minlength="1" maxlength="50">
                                            </div>
                                          </div>

                                          <div class="col-lg-12">
                                            <div class="form-group app-label">
                                              <label>企业官网(可填无)<span class="text-danger"> *</span></label>
                                              <input required class="form-control" placeholder="企业官网" v-model="website" minlength="1" maxlength="100">
                                            </div>
                                          </div>

                                          <div class="col-md-12">
                                            <div class="form-group position-relative">
                                              <label>登录密码<span class="text-danger"> *</span></label>
                                              <b><span style="color:red;font-size: 13px">{{tip.password}}</span></b>
                                              <input required type="password" class="form-control" placeholder="登录密码" name="password" v-model.lazy='password' minlength="6" maxlength="20" @blur="check(password, 4, {minlength: 6, maxlength: 20})">
                                            </div>
                                          </div>
                                          <div class="col-md-12">
                                            <div class="form-group position-relative">
                                              <label>确认您的密码<span class="text-danger"> *</span></label>
                                              <b><span style="color:red;font-size: 13px">{{tip.repassword}}</span></b>
                                              <input required type="password" class="form-control" placeholder="确认您的登录密码" name='repassword' v-model='repassword' minlength="6" maxlength="20" @blur="check({password: password, repassword: repassword},5)">
                                            </div>
                                          </div>

<!--                                          <form action="/uploadlicense" method="post" enctype="multipart/form-data">-->
<!--                                            <img id="img" v-bind:src="photoAddress" class="img-fluid avatar avatar-zhizhao d-block mx-auto ">-->
<!--                                            <div class="shangchuan">-->
<!--                                                <a href="javascript:;" class="file">选择照片<input type="file" class="custom-file-input" id="inputGroupFile01" name = "image" aria-describedby="inputGroupFileAddon01"></a>-->
<!--                                            </div>-->
<!--                                            <div class="shangchuan">-->
<!--                                                <input class="file" type="submit" value="上传" />-->
<!--                                            </div>-->
<!--                                          </form>-->

                                          <iframe name="myiframe" id="myiframe" src="/upload.html" frameborder="0" scrolling="no" width="100%" height="100%">
                                          </iframe>

                                          <div class="col-md-12" style="height: 60px;">
                                            <input type="text" class="form-control phone-Captcha input-val" placeholder="输入验证码" name="Captcha">
                                            <canvas id="canvas" width="100" height="30" style="border: 1px solid rgb(100, 100, 248); margin: 0 0 -10px 0;"></canvas>
                                          </div>
                                          <div class="col-md-12">
                                            <div class="form-group">
                                              <div class="custom-control m-0 custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" id="customCheck1" v-model.lazy="tick" @blur="check(tick,6)">
                                                <label class="custom-control-label" for="customCheck1">我同意 <a
                                                        href="#" class="text-primary">《启迪之星服务条款》</a></label>
                                                <b><span style="color:red;font-size: 13px">{{tip.tick}}</span></b>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="col-md-12">
                                            <button class="btn btn-primary w-100" type="submit">注册</button>
                                          </div>
                                          <div class="mx-auto">
                                            <p class="mb-0 mt-3"><small class="text-dark mr-2">我已经有账号?</small> <a href="login.html" class="text-dark font-weight-bold">登录</a></p>
                                          </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!--end col-->
                    </div>
                    <!--end row-->
                </div>
                <!--end container-->
            </div>
        </div>
    </section>
    <!--end section-->
    <!-- Hero End -->

    <!-- javascript -->
    <script>
      function toSubmit() {
        app.insert();
      }

      var app = new Vue({
        el: '#app',
        data: {
          phone: '',
          username: '',
          companynature: '',
          companysize: '',
          place: '',
          fund: '',
          companytype: '',
          personphone: '',
          email: '',
          simpletro: '',
          introduce: '',
          password: "",
          repassword: "",
          listed: "",
          website: "",
          headquarters: "",
          imshow: "flash",
          emailValidateCode: "",
          photoAddress: "images/zhizhao.jpg",
          rightCode: null,
          tick: false,
          tip: {
            fund: null,
            personphone: null,
            email: null,
            password: null,
            repassword: null,
            tick: null
          }
        },
        methods: {
          check: function (value, mode, params = null) {
            switch (mode) {
              case 1:
                this.tip.fund = checkFund(value);
                break;
              case 2:
                this.tip.personphone = checkAllNumber(value, params);
                break;
              case 3:
                this.tip.email = checkEmail(value);
                break;
              case 4:
                this.tip.password = checkPassword(value, params);
                break;
              case 5:
                this.tip.repassword = checkPwdConfirm(value);
                break;
              case 6:
                this.tip.tick = checkTick(value);
                break;
              default:
            }
          },
          insert: function (response) {
            // 表单验证
            var flag = true;
            for (let i in this.tip) {
              if (this.tip[i] !== "") {
                flag = false;
                break;
              }
            }
            if (this.tick === false) flag = false;
            if (flag === true) {
              // 检查无误,执行下面的逻辑
              this.imshow = Compare_verification_codes()
              if (this.imshow === "flash") {
                alert('图形验证码错误');
              } else if (this.emailValidateCode !== self.rightCode) {
                alert('邮箱验证码错误');
              } else {
                axios
                  .post('/bussiness', {
                    code: '1008',
                    phone: this.phone,
                    username: this.username,
                    companynature: this.companynature,
                    companysize: this.companysize,
                    place: this.place,
                    fund: this.fund,
                    companytype: this.companytype,
                    personphone: this.personphone,
                    email: this.email,
                    simpletro: this.simpletro,
                    introduce: this.introduce,
                    password: this.password,
                    listed: this.listed,
                    website: this.website,
                    headquarters: this.headquarters
                  })
                  .then(function (data) {
                    if (data.data == "success") {
                      alert('注册成功')
                      window.location = "/index.html"
                    } else if (data.data == "errortypeone") {
                      alert('企业已存在')
                      window.location.reload()
                    } else if (data.data == "error") {
                      alert('注册失败')
                      window.location.reload()
                    }
                  })
                  .catch(function (error) {
                    console.log('.....', error);
                  })
              }
            }
            else {
              alert("表单验证有误,请检查所有表单是否都符合要求!")
            }

          }
        },
          mounted() {
              var self = this
              axios.post('/bussiness', {
                  code: "1014"
              })
                  .then(function(response) {
                      if (response.data == "errortypenouser") {
                          alert("用户未登录")
                          window.location = "login.html"
                      } else if (response.data == "notcompany") {
                          alert("登录用户非学生单位")
                          window.location = "index.html"
                      }
                  })
                  .catch(function(error) {
                      console.log(error);
                  });
              axios.post('/users', {
                  code: "1005",
              })
                  .then(function(response) {
                      if (response.data == "nouser") {
                          self.name = "未登录"
                      } else {
                          self.name = response.data.username
                          self.isadmin = response.data.studentisadmin
                          self.phone = response.data.phone
                          if (self.isadmin == "2") {
                              self.newlin = "/enterpriseCenter.html?phone=" + "'" + self.phone + "'"
                              self.showtype = "发布一个岗位"
                              self.turntype = "/post-a-job.html"
                              console.log(self.newlin)
                          }
                          if (self.isadmin == "0") {
                              self.newlin = "/userCenter.html?phone=" + "'" + self.phone + "'"
                              self.showtype = "完善简历"
                              self.turntype = "create-resume.html"
                              console.log(self.newlin)
                          }
                      }
                  })
                  .catch(function(error) {
                      console.log(error);
                  });
              axios
                  .post('/searchPhoto', {
                      flag : "create-resume"
                  })
                  .then(function(response) {
                      console.log("返回的头像地址：" + response.data[0].imgadress);
                      if (response.data == "error") {
                          console.log("头像查询时出现错误");
                      } else if (response.data == "noPhoto") {
                          self.photoAddress = "images/zhizhao.jpg";
                      } else {
                          self.photoAddress = response.data[0].imgadress;
                      }
                      console.log(self.photoAddress);
                  })
                  .catch(function(error) {
                      console.log(error);
                  })
          },
      })
    </script>
    <script type="text/javascript">
        var img = document.querySelector('input[name=image]');
        imgs = document.querySelector('#img');
        if (img) {
            img.addEventListener('change', function() {
                var file = this.files[0];
                var reader = new FileReader();
                // 监听reader对象的的onload事件，当图片加载完成时，把base64编码賦值给预览图片
                reader.addEventListener("load", function() {
                    imgs.src = reader.result;
                }, false);
                // 调用reader.readAsDataURL()方法，把图片转成base64
                reader.readAsDataURL(file);
                $("img").eq(1).css("display", "block");
            }, false);
        }
    </script>
</body>

</html>
